const sql = require('mssql');
const config = { server: 'refopen-sqlserver-dev.database.windows.net', database: 'refopen-sql-db-dev', user: 'sqladmin', password: 'RefOpenDev@2024!Tle@yTK$', options: { encrypt: true, trustServerCertificate: false } };

function w(b) { return '<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width,initial-scale=1">\n<title>{{TITLE}}</title>\n<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>\n<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Crimson+Pro:wght@400;500;600&family=Merriweather:wght@300;400;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">\n<style>{{STYLES}}</style>\n</head>\n<body>\n' + b + '\n</body>\n</html>'; }

const templates = [
  { slug: 'classic',
    html: w('<div class="resume"><header class="header"><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="summary-block">{{SUMMARY_TEXT}}</div><main class="content">{{SECTIONS_HTML}}</main></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: "Crimson Pro", Georgia, "Times New Roman", serif; font-size: 11pt; line-height: 1.45; color: #1a1a1a; background: #fff; -webkit-font-smoothing: antialiased; } .resume { max-width: 8.5in; margin: 0 auto; padding: 0.65in 0.75in; } .header { text-align: center; margin-bottom: 14pt; border-bottom: 1.5pt solid #1a1a1a; padding-bottom: 12pt; } .name { font-size: 24pt; font-weight: 600; letter-spacing: 0.5pt; color: #1a1a1a; margin-bottom: 6pt; } .contact-line { font-size: 10pt; color: #444; margin-bottom: 3pt; } .contact-line .sep { margin: 0 8pt; color: #bbb; } .links-line { font-size: 9.5pt; } .links-line a { color: #2563EB; text-decoration: none; } .links-line .sep { margin: 0 6pt; color: #bbb; } .summary-block { font-size: 10.5pt; color: #333; font-style: italic; margin-bottom: 16pt; line-height: 1.5; padding: 0 4pt; } .section { margin-bottom: 14pt; } .section-title { font-size: 12pt; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5pt; color: #1a1a1a; border-bottom: 0.75pt solid #ccc; padding-bottom: 3pt; margin-bottom: 8pt; } .entry { margin-bottom: 10pt; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: 600; font-size: 11pt; } .entry-subtitle { font-size: 10.5pt; color: #555; } .entry-date { font-size: 9.5pt; color: #666; white-space: nowrap; } .entry-location { font-size: 9.5pt; color: #666; margin-top: 1pt; } .bullets { margin: 4pt 0 0 18pt; } .bullets li { font-size: 10.5pt; line-height: 1.45; margin-bottom: 2pt; color: #222; } .skill-category { margin-bottom: 6pt; display: flex; flex-wrap: wrap; align-items: baseline; gap: 4pt; } .skill-category-name { font-weight: 600; font-size: 10.5pt; margin-right: 4pt; } .skill-tags { display: flex; flex-wrap: wrap; gap: 4pt; } .skill-tag { font-size: 9.5pt; padding: 2pt 8pt; background: #f3f4f6; border: 0.5pt solid #e5e7eb; border-radius: 3pt; color: #374151; } .cert-entry { margin-bottom: 4pt; font-size: 10.5pt; } .cert-name { font-weight: 600; } .cert-issuer { color: #555; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .resume { padding: 0.6in 0.75in; } }'
  },
  { slug: 'modern',
    html: w('<div class="resume"><header class="header"><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="summary-block">{{SUMMARY_TEXT}}</div><div class="two-col"><main class="main-col">{{MAIN_SECTIONS_HTML}}</main><aside class="sidebar-col">{{SIDEBAR_SECTIONS_HTML}}</aside></div></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-size: 10pt; line-height: 1.4; color: #111827; background: #fff; -webkit-font-smoothing: antialiased; } .resume { max-width: 8.5in; margin: 0 auto; padding: 0.5in 0.6in; } .header { text-align: center; padding-bottom: 14pt; margin-bottom: 14pt; background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%); margin: -0.5in -0.6in 14pt -0.6in; padding: 0.5in 0.6in 14pt 0.6in; } .name { font-size: 26pt; font-weight: 700; color: #1E3A5F; letter-spacing: -0.5pt; margin-bottom: 6pt; } .contact-line { font-size: 9.5pt; color: #4B5563; margin-bottom: 3pt; } .contact-line .sep { margin: 0 8pt; color: #9CA3AF; } .links-line { font-size: 9pt; } .links-line a { color: #2563EB; text-decoration: none; font-weight: 500; } .links-line .sep { margin: 0 6pt; color: #9CA3AF; } .summary-block { font-size: 10pt; color: #374151; margin-bottom: 16pt; line-height: 1.5; border-left: 3pt solid #2563EB; padding-left: 12pt; } .two-col { display: flex; gap: 24pt; } .main-col { flex: 7; } .sidebar-col { flex: 3; border-left: 1pt solid #E5E7EB; padding-left: 16pt; } .section { margin-bottom: 14pt; } .section-title { font-size: 11pt; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2pt; color: #1E3A5F; border-bottom: 2pt solid #2563EB; padding-bottom: 3pt; margin-bottom: 8pt; display: inline-block; } .entry { margin-bottom: 10pt; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: 600; font-size: 10.5pt; color: #111827; } .entry-subtitle { font-size: 10pt; color: #6B7280; } .entry-date { font-size: 9pt; color: #2563EB; font-weight: 500; white-space: nowrap; } .entry-location { font-size: 9pt; color: #6B7280; margin-top: 1pt; } .bullets { margin: 4pt 0 0 16pt; } .bullets li { font-size: 10pt; line-height: 1.4; margin-bottom: 2pt; color: #374151; } .skill-category { margin-bottom: 8pt; } .skill-category-name { font-weight: 600; font-size: 9.5pt; color: #1E3A5F; display: block; margin-bottom: 4pt; } .skill-tags { display: flex; flex-wrap: wrap; gap: 4pt; } .skill-tag { font-size: 8.5pt; padding: 3pt 8pt; background: #EEF2FF; color: #3B52A5; border-radius: 10pt; font-weight: 500; } .cert-entry { margin-bottom: 5pt; font-size: 10pt; } .cert-name { font-weight: 600; } .cert-issuer { color: #6B7280; font-size: 9.5pt; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .header { break-inside: avoid; } }'
  },
  { slug: 'minimal',
    html: w('<div class="resume"><header class="header"><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="summary-block">{{SUMMARY_TEXT}}</div><main class="content">{{SECTIONS_HTML}}</main></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif; font-size: 10.5pt; line-height: 1.55; color: #000; background: #fff; -webkit-font-smoothing: antialiased; } .resume { max-width: 8.5in; margin: 0 auto; padding: 0.7in 0.85in; } .header { margin-bottom: 20pt; } .name { font-size: 28pt; font-weight: 300; letter-spacing: -0.5pt; color: #000; margin-bottom: 8pt; } .contact-line { font-size: 9.5pt; color: #666; } .contact-line .sep { margin: 0 10pt; color: #ccc; } .links-line { font-size: 9pt; margin-top: 3pt; } .links-line a { color: #000; text-decoration: none; border-bottom: 0.5pt solid #999; padding-bottom: 0.5pt; } .links-line .sep { margin: 0 8pt; color: #ccc; } .summary-block { font-size: 10pt; color: #444; margin-bottom: 22pt; line-height: 1.6; } .section { margin-bottom: 18pt; } .section-title { font-size: 9pt; font-weight: 600; text-transform: uppercase; letter-spacing: 2.5pt; color: #999; margin-bottom: 10pt; } .entry { margin-bottom: 12pt; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: 600; font-size: 10.5pt; } .entry-subtitle { font-size: 10pt; color: #666; font-weight: 400; } .entry-date { font-size: 9pt; color: #999; white-space: nowrap; } .entry-location { font-size: 9pt; color: #999; margin-top: 1pt; } .bullets { margin: 5pt 0 0 16pt; list-style: none; } .bullets li { font-size: 10pt; line-height: 1.55; margin-bottom: 3pt; color: #333; position: relative; padding-left: 2pt; } .skill-category { margin-bottom: 6pt; display: flex; flex-wrap: wrap; align-items: baseline; gap: 4pt; } .skill-category-name { font-weight: 600; font-size: 10pt; color: #333; margin-right: 6pt; } .skill-tags { display: flex; flex-wrap: wrap; gap: 6pt; } .skill-tag { font-size: 9pt; color: #555; padding: 0; } .cert-entry { margin-bottom: 4pt; font-size: 10pt; } .cert-name { font-weight: 500; } .cert-issuer { color: #999; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }'
  },
  { slug: 'executive',
    html: w('<div class="resume"><header class="header"><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="body-content"><div class="summary-block">{{SUMMARY_TEXT}}</div><main class="content">{{SECTIONS_HTML}}</main></div></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: "Merriweather", Georgia, serif; font-size: 10.5pt; line-height: 1.45; color: #1F2937; background: #fff; -webkit-font-smoothing: antialiased; } .resume { max-width: 8.5in; margin: 0 auto; } .header { background: #111827; color: #fff; padding: 0.55in 0.65in 0.4in; text-align: center; } .name { font-size: 26pt; font-weight: 700; letter-spacing: 1pt; margin-bottom: 8pt; color: #F9FAFB; } .contact-line { font-size: 9.5pt; color: #D1D5DB; margin-bottom: 3pt; } .contact-line .sep { margin: 0 10pt; color: #6B7280; } .links-line { font-size: 9pt; } .links-line a { color: #93C5FD; text-decoration: none; } .links-line .sep { margin: 0 6pt; color: #6B7280; } .body-content { padding: 0 0.65in 0.5in; } .summary-block { font-size: 10.5pt; color: #374151; line-height: 1.55; margin: 18pt 0 16pt; border-left: 3pt solid #1E40AF; padding-left: 12pt; } .section { margin-bottom: 14pt; } .section-title { font-size: 11.5pt; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5pt; color: #111827; border-bottom: 2pt solid #1E40AF; padding-bottom: 4pt; margin-bottom: 10pt; } .entry { margin-bottom: 10pt; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: 700; font-size: 11pt; color: #111827; } .entry-subtitle { font-size: 10pt; color: #4B5563; } .entry-date { font-size: 9pt; color: #1E40AF; font-weight: 600; white-space: nowrap; } .entry-location { font-size: 9pt; color: #6B7280; margin-top: 1pt; font-style: italic; } .bullets { margin: 5pt 0 0 18pt; } .bullets li { font-size: 10.5pt; line-height: 1.45; margin-bottom: 3pt; color: #1F2937; } .skill-category { margin-bottom: 8pt; display: flex; flex-wrap: wrap; align-items: baseline; gap: 5pt; } .skill-category-name { font-weight: 700; font-size: 10pt; color: #111827; margin-right: 6pt; } .skill-tags { display: flex; flex-wrap: wrap; gap: 5pt; } .skill-tag { font-size: 9pt; padding: 2.5pt 10pt; background: #F3F4F6; border: 0.5pt solid #D1D5DB; border-radius: 3pt; color: #1F2937; font-weight: 500; } .cert-entry { margin-bottom: 5pt; font-size: 10.5pt; } .cert-name { font-weight: 700; } .cert-issuer { color: #4B5563; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .header { break-inside: avoid; } }'
  },
  { slug: 'ats-optimized',
    html: w('<div class="resume"><header class="header"><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="summary-block">{{SUMMARY_TEXT}}</div><main class="content">{{SECTIONS_HTML}}</main></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: Arial, Helvetica, sans-serif; font-size: 11pt; line-height: 1.4; color: #000; background: #fff; } .resume { max-width: 8.5in; margin: 0 auto; padding: 0.5in 0.75in; } .header { text-align: center; margin-bottom: 12pt; padding-bottom: 8pt; border-bottom: 1pt solid #000; } .name { font-size: 22pt; font-weight: bold; margin-bottom: 4pt; } .contact-line { font-size: 10pt; margin-bottom: 2pt; } .contact-line .sep { margin: 0 6pt; } .links-line { font-size: 10pt; } .links-line a { color: #000; text-decoration: underline; } .links-line .sep { margin: 0 6pt; } .summary-block { font-size: 10.5pt; margin-bottom: 14pt; line-height: 1.45; } .section { margin-bottom: 12pt; } .section-title { font-size: 12pt; font-weight: bold; text-transform: uppercase; border-bottom: 1pt solid #000; padding-bottom: 2pt; margin-bottom: 6pt; } .entry { margin-bottom: 8pt; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: bold; font-size: 11pt; } .entry-subtitle { font-size: 10.5pt; } .entry-date { font-size: 10pt; white-space: nowrap; } .entry-location { font-size: 10pt; } .bullets { margin: 3pt 0 0 18pt; } .bullets li { font-size: 10.5pt; line-height: 1.4; margin-bottom: 2pt; } .skill-category { margin-bottom: 4pt; } .skill-category-name { font-weight: bold; font-size: 10.5pt; } .skill-tags { display: inline; } .skill-tag { font-size: 10.5pt; } .skill-tag::after { content: ", "; } .skill-tag:last-child::after { content: ""; } .cert-entry { margin-bottom: 3pt; font-size: 10.5pt; } .cert-name { font-weight: bold; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }'
  },
  { slug: 'tech',
    html: w('<div class="resume"><header class="header"><div class="header-prefix">&gt;_</div><h1 class="name">{{FULL_NAME}}</h1><div class="contact-line">{{CONTACT_HTML}}</div><div class="links-line">{{LINKS_HTML}}</div></header><div class="summary-block">{{SUMMARY_TEXT}}</div><main class="content">{{SECTIONS_HTML}}</main></div>'),
    css: '*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; } @page { size: A4; margin: 0; } body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-size: 10pt; line-height: 1.4; color: #C9D1D9; background: #0D1117; -webkit-font-smoothing: antialiased; } .resume { max-width: 8.5in; margin: 0 auto; padding: 0.5in 0.65in; background: #0D1117; } .header { border: 1pt solid #30363D; border-radius: 6pt; padding: 18pt 20pt; margin-bottom: 16pt; background: #161B22; text-align: center; } .header-prefix { font-family: "JetBrains Mono", "Fira Code", monospace; font-size: 10pt; color: #58A6FF; margin-bottom: 4pt; } .name { font-family: "JetBrains Mono", monospace; font-size: 24pt; font-weight: 600; color: #F0F6FC; letter-spacing: -0.5pt; margin-bottom: 8pt; } .contact-line { font-size: 9.5pt; color: #8B949E; } .contact-line .sep { margin: 0 8pt; color: #30363D; } .links-line { font-size: 9pt; margin-top: 4pt; } .links-line a { color: #58A6FF; text-decoration: none; font-family: "JetBrains Mono", monospace; font-size: 8.5pt; } .links-line .sep { margin: 0 6pt; color: #30363D; } .summary-block { font-size: 10pt; color: #8B949E; margin-bottom: 16pt; padding: 12pt 14pt; background: #161B22; border-left: 3pt solid #58A6FF; border-radius: 4pt; line-height: 1.5; } .section { margin-bottom: 16pt; border: 1pt solid #21262D; border-radius: 6pt; padding: 14pt 16pt; background: #161B22; } .section-title { font-family: "JetBrains Mono", monospace; font-size: 10pt; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5pt; color: #58A6FF; margin-bottom: 10pt; padding-bottom: 6pt; border-bottom: 1pt solid #21262D; } .entry { margin-bottom: 10pt; padding-bottom: 8pt; border-bottom: 1pt solid #21262D; } .entry:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; } .entry-header { display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; } .entry-title { font-weight: 600; font-size: 10.5pt; color: #F0F6FC; } .entry-subtitle { font-size: 10pt; color: #8B949E; } .entry-date { font-family: "JetBrains Mono", monospace; font-size: 8.5pt; color: #58A6FF; white-space: nowrap; background: #0D1117; padding: 2pt 8pt; border-radius: 10pt; } .entry-location { font-size: 9pt; color: #6E7681; margin-top: 2pt; } .bullets { margin: 5pt 0 0 16pt; list-style: none; } .bullets li { font-size: 10pt; line-height: 1.4; margin-bottom: 3pt; color: #C9D1D9; position: relative; padding-left: 2pt; } .skill-category { margin-bottom: 8pt; } .skill-category-name { font-family: "JetBrains Mono", monospace; font-weight: 600; font-size: 9pt; color: #F0F6FC; display: block; margin-bottom: 5pt; } .skill-tags { display: flex; flex-wrap: wrap; gap: 5pt; } .skill-tag { font-family: "JetBrains Mono", monospace; font-size: 8.5pt; padding: 3pt 10pt; background: #0D1117; color: #7EE787; border: 1pt solid #238636; border-radius: 12pt; font-weight: 500; } .cert-entry { margin-bottom: 5pt; font-size: 10pt; } .cert-name { font-weight: 600; color: #F0F6FC; } .cert-issuer { color: #8B949E; } @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }'
  }
];

async function main() {
  let pool;
  try {
    console.log('Connecting...');
    pool = await sql.connect(config);
    for (const t of templates) {
      console.log('Updating: ' + t.slug);
      const r = await pool.request()
        .input('slug', sql.NVarChar, t.slug)
        .input('html', sql.NVarChar(sql.MAX), t.html)
        .input('css', sql.NVarChar(sql.MAX), t.css)
        .query('UPDATE ResumeBuilderTemplates SET HtmlTemplate=@html, CssTemplate=@css, UpdatedAt=GETUTCDATE() WHERE Slug=@slug');
      console.log('  -> ' + r.rowsAffected[0] + ' rows');
    }
    const v = await pool.request().query('SELECT TemplateID,Slug,LEN(HtmlTemplate) AS HtmlLen,LEN(CssTemplate) AS CssLen FROM ResumeBuilderTemplates ORDER BY SortOrder');
    console.log('Done:');
    console.table(v.recordset);
  } catch(e) { console.error(e.message); }
  finally { if(pool) await pool.close(); }
}
main();
